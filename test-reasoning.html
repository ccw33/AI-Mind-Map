<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨ç†æ¨¡å‹æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .reasoning {
            color: #666;
            font-style: italic;
        }
        .final-answer {
            color: #333;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  æ¨ç†æ¨¡å‹æµ‹è¯•é¡µé¢</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æ¨ç†è¿‡ç¨‹æ£€æµ‹åŠŸèƒ½ã€‚æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ã€‚</p>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•1: æ¨¡æ‹Ÿdeepseek-reasonerå®˜æ–¹æ ¼å¼å“åº”</div>
            <button onclick="testDeepSeekReasonerOfficial()">æµ‹è¯• DeepSeek Reasoner å®˜æ–¹æ ¼å¼</button>
            <div id="result1" class="result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•2: æ¨¡æ‹Ÿdeepseek-reasoneræ—§æ ¼å¼å“åº”</div>
            <button onclick="testDeepSeekReasonerLegacy()">æµ‹è¯• DeepSeek Reasoner æ—§æ ¼å¼</button>
            <div id="result2" class="result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•3: æ¨¡æ‹Ÿå¸¦thinkingæ ‡ç­¾çš„å“åº”</div>
            <button onclick="testThinkingTags()">æµ‹è¯• Thinking æ ‡ç­¾</button>
            <div id="result3" class="result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•4: æ¨¡æ‹Ÿä¸­æ–‡æ¨ç†æ ¼å¼</div>
            <button onclick="testChineseReasoning()">æµ‹è¯•ä¸­æ–‡æ¨ç†</button>
            <div id="result4" class="result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•5: æ¨¡æ‹Ÿæ™®é€šæ¨¡å‹å“åº”</div>
            <button onclick="testNormalModel()">æµ‹è¯•æ™®é€šæ¨¡å‹</button>
            <div id="result5" class="result"></div>
        </div>
    </div>

    <script>
        // å¤åˆ¶æ¨ç†è¿‡ç¨‹æ£€æµ‹å‡½æ•°
        function extractReasoningProcess(data, rawContent) {
            const result = {
                isReasoningModel: false,
                reasoning: null,
                finalAnswer: null
            };

            // æ£€æµ‹æ–¹æ³•1: æ£€æŸ¥æ¨¡å‹åç§°æ˜¯å¦åŒ…å«æ¨ç†ç›¸å…³å…³é”®è¯
            const modelName = (data.model || '').toLowerCase();
            const reasoningKeywords = ['reasoner', 'reasoning', 'think', 'cot', 'chain-of-thought'];
            const isReasoningByModel = reasoningKeywords.some(keyword => modelName.includes(keyword));

            // æ£€æµ‹æ–¹æ³•2: æ£€æŸ¥å“åº”ç»“æ„æ˜¯å¦åŒ…å«æ¨ç†å­—æ®µï¼ˆDeepSeekå®˜æ–¹æ ¼å¼ï¼‰
            const choice = data.choices && data.choices[0];
            const hasDeepSeekReasoningField = choice && choice.message && choice.message.reasoning_content;

            // æ£€æµ‹æ–¹æ³•3: æ£€æŸ¥å“åº”ç»“æ„æ˜¯å¦åŒ…å«å…¶ä»–æ¨ç†å­—æ®µï¼ˆå…¼å®¹å…¶ä»–æ ¼å¼ï¼‰
            const hasOtherReasoningField = choice && (choice.reasoning || choice.message?.reasoning);

            // æ£€æµ‹æ–¹æ³•3: æ£€æŸ¥å†…å®¹æ ¼å¼æ˜¯å¦ç¬¦åˆæ¨ç†æ¨¡å¼
            const hasReasoningPattern = rawContent && (
                rawContent.includes('<thinking>') ||
                rawContent.includes('<reasoning>') ||
                rawContent.includes('è®©æˆ‘æ€è€ƒä¸€ä¸‹') ||
                rawContent.includes('æ€è€ƒè¿‡ç¨‹ï¼š') ||
                rawContent.includes('æ¨ç†è¿‡ç¨‹ï¼š') ||
                /^[\s\S]*?(?:æ€è€ƒ|æ¨ç†|åˆ†æ)[\s\S]*?(?:ç»“è®º|ç­”æ¡ˆ|å›ç­”)[\s\S]*$/i.test(rawContent)
            );

            result.isReasoningModel = isReasoningByModel || hasDeepSeekReasoningField || hasOtherReasoningField || hasReasoningPattern;

            if (result.isReasoningModel) {
                // æå–æ¨ç†è¿‡ç¨‹
                if (choice && choice.message && choice.message.reasoning_content) {
                    // æ–¹æ³•1: DeepSeekå®˜æ–¹æ ¼å¼ - ä»message.reasoning_contentå­—æ®µæå–
                    result.reasoning = choice.message.reasoning_content;
                    result.finalAnswer = rawContent; // rawContentå°±æ˜¯contentå­—æ®µçš„å†…å®¹
                } else if (choice && choice.reasoning) {
                    // æ–¹æ³•2: ä»APIå“åº”çš„reasoningå­—æ®µæå–ï¼ˆå…¶ä»–æ ¼å¼ï¼‰
                    result.reasoning = choice.reasoning;
                    result.finalAnswer = rawContent;
                } else if (choice && choice.message && choice.message.reasoning) {
                    // æ–¹æ³•3: ä»message.reasoningå­—æ®µæå–ï¼ˆå…¶ä»–æ ¼å¼ï¼‰
                    result.reasoning = choice.message.reasoning;
                    result.finalAnswer = rawContent;
                } else if (rawContent) {
                    // æ–¹æ³•3: ä»å†…å®¹ä¸­è§£ææ¨ç†è¿‡ç¨‹
                    const reasoningPatterns = [
                        // <thinking>æ ‡ç­¾æ ¼å¼
                        /<thinking>([\s\S]*?)<\/thinking>/i,
                        /<reasoning>([\s\S]*?)<\/reasoning>/i,
                        // ä¸­æ–‡æ ¼å¼
                        /(?:æ€è€ƒè¿‡ç¨‹ï¼š|æ¨ç†è¿‡ç¨‹ï¼š|è®©æˆ‘æ€è€ƒä¸€ä¸‹[ï¼š:]?)([\s\S]*?)(?:ç»“è®ºï¼š|ç­”æ¡ˆï¼š|å›ç­”ï¼š|æœ€ç»ˆç­”æ¡ˆï¼š)/i,
                        // åˆ†æ®µæ ¼å¼
                        /^([\s\S]*?)(?:\n\n|^)(?:ç»“è®º|ç­”æ¡ˆ|å›ç­”|æœ€ç»ˆç­”æ¡ˆ)[ï¼š:]?([\s\S]*)$/i
                    ];

                    for (const pattern of reasoningPatterns) {
                        const match = rawContent.match(pattern);
                        if (match) {
                            if (pattern.source.includes('thinking') || pattern.source.includes('reasoning')) {
                                result.reasoning = match[1].trim();
                                result.finalAnswer = rawContent.replace(match[0], '').trim();
                            } else if (pattern.source.includes('æ€è€ƒè¿‡ç¨‹') || pattern.source.includes('æ¨ç†è¿‡ç¨‹')) {
                                result.reasoning = match[1].trim();
                                const finalMatch = rawContent.match(/(?:ç»“è®ºï¼š|ç­”æ¡ˆï¼š|å›ç­”ï¼š|æœ€ç»ˆç­”æ¡ˆï¼š)([\s\S]*)$/i);
                                result.finalAnswer = finalMatch ? finalMatch[1].trim() : rawContent;
                            } else {
                                result.reasoning = match[1].trim();
                                result.finalAnswer = match[2] ? match[2].trim() : rawContent;
                            }
                            break;
                        }
                    }

                    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ˜ç¡®çš„åˆ†éš”ï¼Œä½†æ£€æµ‹åˆ°æ˜¯æ¨ç†æ¨¡å‹ï¼Œå°è¯•æ™ºèƒ½åˆ†å‰²
                    if (!result.reasoning && result.isReasoningModel) {
                        const lines = rawContent.split('\n');
                        const thinkingLines = [];
                        const answerLines = [];
                        let isInAnswer = false;

                        for (const line of lines) {
                            const trimmed = line.trim();
                            if (trimmed.match(/^(?:ç»“è®º|ç­”æ¡ˆ|å›ç­”|æœ€ç»ˆç­”æ¡ˆ|æ€»ç»“)[ï¼š:]?/i)) {
                                isInAnswer = true;
                            }

                            if (isInAnswer) {
                                answerLines.push(line);
                            } else {
                                thinkingLines.push(line);
                            }
                        }

                        if (thinkingLines.length > 0 && answerLines.length > 0) {
                            result.reasoning = thinkingLines.join('\n').trim();
                            result.finalAnswer = answerLines.join('\n').trim();
                        }
                    }
                }
            }

            return result;
        }

        function testDeepSeekReasonerOfficial() {
            // æ ¹æ®DeepSeekå®˜æ–¹æ–‡æ¡£çš„æ ¼å¼
            const mockData = {
                model: "deepseek-reasoner",
                choices: [{
                    message: {
                        reasoning_content: "ç”¨æˆ·è¯¢é—®å…³äºæ€ç»´å¯¼å›¾çš„é—®é¢˜ã€‚æˆ‘éœ€è¦åˆ†æå½“å‰é€‰ä¸­çš„èŠ‚ç‚¹ï¼Œå¹¶æä¾›ç›¸å…³çš„æ‰©å±•å»ºè®®ã€‚é¦–å…ˆï¼Œæˆ‘è¦ç†è§£èŠ‚ç‚¹çš„ä¸Šä¸‹æ–‡ï¼Œç„¶ååŸºäºè¿™ä¸ªä¸Šä¸‹æ–‡æä¾›æœ‰ä»·å€¼çš„å»ºè®®ã€‚è®©æˆ‘æ€è€ƒä¸€ä¸‹æœ€ä½³çš„å›ç­”æ–¹å¼...",
                        content: "åŸºäºæ‚¨é€‰ä¸­çš„èŠ‚ç‚¹ï¼Œæˆ‘ä¸ºæ‚¨æä¾›ä»¥ä¸‹æ‰©å±•å»ºè®®ï¼š\n\n1. æ ¸å¿ƒæ¦‚å¿µ\n2. åº”ç”¨åœºæ™¯\n3. ç›¸å…³æŠ€æœ¯"
                    }
                }]
            };

            const rawContent = mockData.choices[0].message.content;
            const result = extractReasoningProcess(mockData, rawContent);

            console.log('=== DeepSeek Reasoner å®˜æ–¹æ ¼å¼æµ‹è¯• ===');
            console.log('ğŸ§  æ¨ç†æ¨¡å‹æ£€æµ‹:', result.isReasoningModel ? 'æ˜¯' : 'å¦');
            if (result.reasoning) {
                console.log('ğŸ¤” æ¨ç†è¿‡ç¨‹:');
                console.log('%c' + result.reasoning, 'color: #888; font-style: italic;');
            }
            if (result.finalAnswer) {
                console.log('âœ… æœ€ç»ˆå›ç­”:', result.finalAnswer);
            }
            console.log('==================');

            document.getElementById('result1').innerHTML =
                `æ£€æµ‹ç»“æœ: ${result.isReasoningModel ? 'âœ… æ¨ç†æ¨¡å‹' : 'âŒ æ™®é€šæ¨¡å‹'}\n` +
                `æ¨ç†è¿‡ç¨‹: ${result.reasoning ? 'âœ… å·²æå–' : 'âŒ æœªæ‰¾åˆ°'}\n` +
                `æœ€ç»ˆå›ç­”: ${result.finalAnswer ? 'âœ… å·²æå–' : 'âŒ æœªæ‰¾åˆ°'}`;
        }

        function testDeepSeekReasonerLegacy() {
            // æ—§æ ¼å¼ï¼ˆå…¼å®¹æ€§æµ‹è¯•ï¼‰
            const mockData = {
                model: "deepseek-reasoner",
                choices: [{
                    reasoning: "ç”¨æˆ·è¯¢é—®å…³äºæ€ç»´å¯¼å›¾çš„é—®é¢˜ã€‚æˆ‘éœ€è¦åˆ†æå½“å‰é€‰ä¸­çš„èŠ‚ç‚¹ï¼Œå¹¶æä¾›ç›¸å…³çš„æ‰©å±•å»ºè®®ã€‚é¦–å…ˆï¼Œæˆ‘è¦ç†è§£èŠ‚ç‚¹çš„ä¸Šä¸‹æ–‡ï¼Œç„¶ååŸºäºè¿™ä¸ªä¸Šä¸‹æ–‡æä¾›æœ‰ä»·å€¼çš„å»ºè®®ã€‚",
                    message: {
                        content: "åŸºäºæ‚¨é€‰ä¸­çš„èŠ‚ç‚¹ï¼Œæˆ‘ä¸ºæ‚¨æä¾›ä»¥ä¸‹æ‰©å±•å»ºè®®ï¼š\n\n1. æ ¸å¿ƒæ¦‚å¿µ\n2. åº”ç”¨åœºæ™¯\n3. ç›¸å…³æŠ€æœ¯"
                    }
                }]
            };

            const rawContent = mockData.choices[0].message.content;
            const result = extractReasoningProcess(mockData, rawContent);

            console.log('=== DeepSeek Reasoner æ—§æ ¼å¼æµ‹è¯• ===');
            console.log('ğŸ§  æ¨ç†æ¨¡å‹æ£€æµ‹:', result.isReasoningModel ? 'æ˜¯' : 'å¦');
            if (result.reasoning) {
                console.log('ğŸ¤” æ¨ç†è¿‡ç¨‹:');
                console.log('%c' + result.reasoning, 'color: #888; font-style: italic;');
            }
            if (result.finalAnswer) {
                console.log('âœ… æœ€ç»ˆå›ç­”:', result.finalAnswer);
            }
            console.log('==================');

            document.getElementById('result2').innerHTML =
                `æ£€æµ‹ç»“æœ: ${result.isReasoningModel ? 'âœ… æ¨ç†æ¨¡å‹' : 'âŒ æ™®é€šæ¨¡å‹'}\n` +
                `æ¨ç†è¿‡ç¨‹: ${result.reasoning ? 'âœ… å·²æå–' : 'âŒ æœªæ‰¾åˆ°'}\n` +
                `æœ€ç»ˆå›ç­”: ${result.finalAnswer ? 'âœ… å·²æå–' : 'âŒ æœªæ‰¾åˆ°'}`;
        }

        function testThinkingTags() {
            const mockData = {
                model: "gpt-4",
                choices: [{
                    message: {
                        content: "<thinking>\nè¿™æ˜¯ä¸€ä¸ªå…³äºæ€ç»´å¯¼å›¾çš„é—®é¢˜ã€‚æˆ‘éœ€è¦ä»”ç»†åˆ†æç”¨æˆ·çš„éœ€æ±‚ï¼Œç„¶åæä¾›åˆé€‚çš„å»ºè®®ã€‚è®©æˆ‘æ€è€ƒä¸€ä¸‹æœ€ä½³çš„å›ç­”æ–¹å¼ã€‚\n</thinking>\n\næ ¹æ®æ‚¨çš„é—®é¢˜ï¼Œæˆ‘å»ºè®®ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥æ‰©å±•æ€ç»´å¯¼å›¾ï¼š\n\n1. ä¸»è¦æ¦‚å¿µ\n2. å®é™…åº”ç”¨\n3. ç›¸å…³å·¥å…·"
                    }
                }]
            };

            const rawContent = mockData.choices[0].message.content;
            const result = extractReasoningProcess(mockData, rawContent);

            console.log('=== Thinking æ ‡ç­¾æµ‹è¯• ===');
            console.log('ğŸ§  æ¨ç†æ¨¡å‹æ£€æµ‹:', result.isReasoningModel ? 'æ˜¯' : 'å¦');
            if (result.reasoning) {
                console.log('ğŸ¤” æ¨ç†è¿‡ç¨‹:');
                console.log('%c' + result.reasoning, 'color: #888; font-style: italic;');
            }
            if (result.finalAnswer) {
                console.log('âœ… æœ€ç»ˆå›ç­”:', result.finalAnswer);
            }
            console.log('==================');

            document.getElementById('result3').innerHTML =
                `æ£€æµ‹ç»“æœ: ${result.isReasoningModel ? 'âœ… æ¨ç†æ¨¡å‹' : 'âŒ æ™®é€šæ¨¡å‹'}\n` +
                `æ¨ç†è¿‡ç¨‹: ${result.reasoning ? 'âœ… å·²æå–' : 'âŒ æœªæ‰¾åˆ°'}\n` +
                `æœ€ç»ˆå›ç­”: ${result.finalAnswer ? 'âœ… å·²æå–' : 'âŒ æœªæ‰¾åˆ°'}`;
        }

        function testChineseReasoning() {
            const mockData = {
                model: "qwen-plus",
                choices: [{
                    message: {
                        content: "æ€è€ƒè¿‡ç¨‹ï¼šç”¨æˆ·é€‰æ‹©äº†ä¸€ä¸ªæ€ç»´å¯¼å›¾èŠ‚ç‚¹ï¼Œæƒ³è¦è·å¾—æ‰©å±•å»ºè®®ã€‚æˆ‘éœ€è¦åˆ†æè¿™ä¸ªèŠ‚ç‚¹çš„ä¸Šä¸‹æ–‡ï¼Œç†è§£å®ƒåœ¨æ•´ä¸ªæ€ç»´å¯¼å›¾ä¸­çš„ä½ç½®å’Œä½œç”¨ï¼Œç„¶åæä¾›æœ‰é’ˆå¯¹æ€§çš„å»ºè®®ã€‚\n\nç»“è®ºï¼šåŸºäºæ‚¨é€‰ä¸­çš„èŠ‚ç‚¹ï¼Œæˆ‘æ¨èä»¥ä¸‹æ‰©å±•æ–¹å‘ï¼š\n\n1. ç†è®ºåŸºç¡€\n2. å®è·µæ–¹æ³•\n3. æ¡ˆä¾‹åˆ†æ"
                    }
                }]
            };

            const rawContent = mockData.choices[0].message.content;
            const result = extractReasoningProcess(mockData, rawContent);

            console.log('=== ä¸­æ–‡æ¨ç†æ ¼å¼æµ‹è¯• ===');
            console.log('ğŸ§  æ¨ç†æ¨¡å‹æ£€æµ‹:', result.isReasoningModel ? 'æ˜¯' : 'å¦');
            if (result.reasoning) {
                console.log('ğŸ¤” æ¨ç†è¿‡ç¨‹:');
                console.log('%c' + result.reasoning, 'color: #888; font-style: italic;');
            }
            if (result.finalAnswer) {
                console.log('âœ… æœ€ç»ˆå›ç­”:', result.finalAnswer);
            }
            console.log('==================');

            document.getElementById('result4').innerHTML =
                `æ£€æµ‹ç»“æœ: ${result.isReasoningModel ? 'âœ… æ¨ç†æ¨¡å‹' : 'âŒ æ™®é€šæ¨¡å‹'}\n` +
                `æ¨ç†è¿‡ç¨‹: ${result.reasoning ? 'âœ… å·²æå–' : 'âŒ æœªæ‰¾åˆ°'}\n` +
                `æœ€ç»ˆå›ç­”: ${result.finalAnswer ? 'âœ… å·²æå–' : 'âŒ æœªæ‰¾åˆ°'}`;
        }

        function testNormalModel() {
            const mockData = {
                model: "gpt-3.5-turbo",
                choices: [{
                    message: {
                        content: "åŸºäºæ‚¨é€‰ä¸­çš„æ€ç»´å¯¼å›¾èŠ‚ç‚¹ï¼Œæˆ‘ä¸ºæ‚¨æä¾›ä»¥ä¸‹æ‰©å±•å»ºè®®ï¼š\n\n1. æ ¸å¿ƒè¦ç‚¹\n2. è¯¦ç»†è¯´æ˜\n3. ç›¸å…³é“¾æ¥\n\nè¿™äº›å»ºè®®å¯ä»¥å¸®åŠ©æ‚¨æ›´å¥½åœ°å®Œå–„æ€ç»´å¯¼å›¾çš„å†…å®¹ã€‚"
                    }
                }]
            };

            const rawContent = mockData.choices[0].message.content;
            const result = extractReasoningProcess(mockData, rawContent);

            console.log('=== æ™®é€šæ¨¡å‹æµ‹è¯• ===');
            console.log('ğŸ§  æ¨ç†æ¨¡å‹æ£€æµ‹:', result.isReasoningModel ? 'æ˜¯' : 'å¦');
            if (result.reasoning) {
                console.log('ğŸ¤” æ¨ç†è¿‡ç¨‹:');
                console.log('%c' + result.reasoning, 'color: #888; font-style: italic;');
            }
            if (result.finalAnswer) {
                console.log('âœ… æœ€ç»ˆå›ç­”:', result.finalAnswer);
            }
            console.log('==================');

            document.getElementById('result5').innerHTML =
                `æ£€æµ‹ç»“æœ: ${result.isReasoningModel ? 'âœ… æ¨ç†æ¨¡å‹' : 'âŒ æ™®é€šæ¨¡å‹'}\n` +
                `æ¨ç†è¿‡ç¨‹: ${result.reasoning ? 'âœ… å·²æå–' : 'âŒ æœªæ‰¾åˆ°'}\n` +
                `æœ€ç»ˆå›ç­”: ${result.finalAnswer ? 'âœ… å·²æå–' : 'âŒ æœªæ‰¾åˆ°'}`;
        }
    </script>
</body>
</html>
